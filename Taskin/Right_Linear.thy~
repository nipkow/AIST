theory Right_Linear
imports "../Stimpfle/uProds" Binarize
begin

definition rlin :: "('n, 't) prods \<Rightarrow> bool" where
"rlin ps = (\<forall>(A,w) \<in> set ps. \<exists>u. w = map Tm u \<or> (\<exists>B. w = map Tm u @ [Nt B]))"

definition rlin_nounit :: "('n, 't) prods \<Rightarrow> bool" where
"rlin_nounit ps = (\<forall>(A,w) \<in> set ps. \<exists>u. w = map Tm u \<or> (\<exists>B. w = map Tm u @ [Nt B] \<and> length u > 0))"

definition rlin_eps :: "('n, 't) prods \<Rightarrow> bool" where
"rlin_eps ps = (\<forall>(A,w) \<in> set ps. w = [] \<or> (\<exists>B u. w = map Tm u @ [Nt B] \<and> length u > 0))"

definition rlin2 :: "('a, 't) prods \<Rightarrow> bool" where
"rlin2 ps = (\<forall>(A,w) \<in> set ps. w = [] \<or> (\<exists>a B. w = [Tm a, Nt B]))"

(* Idea:
   1) Let ps in rlin.
   2) Eliminate unit productions, the new production set satisfies rlin_nounit (not executable, with definition of uppr)
   3) Add a non-terminal to the end for every production that contains only terminals, the only production
      this new non-terminal have is the empty word (write a executable function or definition?), the new production set
      satisfies rlin_eps
   4) Binarize, the new production set satisfies rlin2

   lang preservation:
   2) proved.
   3) not proved.
   4) proved.

   2-3) clean?
*)

lemma "rlin2 ps \<Longrightarrow> rlin ps"
  unfolding rlin_def rlin2_def
  by (auto split: prod.splits) (metis (no_types, lifting) append_eq_Cons_conv map_eq_Cons_conv map_is_Nil_conv)

lemma 
  assumes "rlin ps"
    and "uppr ps ps'"
  shows "rlin_nounit ps'"
  sorry

lemma 
  assumes "rlin_eps ps"
  shows "rlin2 (binarize ps)"
  sorry

definition clean :: "('n,'t)prods \<Rightarrow> ('n,'t)prods" where "clean = undefined"

lemma lang_clean: "lang ps A  = lang (clean ps) A"
  sorry

definition rlin2_of_rlin :: "('n,'t)prods \<Rightarrow> ('n,'t)prods" where
"rlin2_of_rlin ps = undefined"

lemma rlin2_rlin2_of_rlin: assumes "rlin ps" shows "rlin2 (rlin2_of_rlin ps)"
sorry

lemma lang_rlin2_of_rlin: assumes "rlin ps" "A \<in> nts (set ps)"
shows "lang ps A = lang (rlin2_of_rlin ps) A"
sorry

end